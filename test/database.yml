<% mysql = URI(ENV['MYSQL_URL'] || 'mysql://root@127.0.0.1:3306') %>

<%
default_config = <<-YAML
    encoding: utf8
    adapter: mysql2
    username: #{mysql.user}
    password: #{mysql.password}
    host: 127.0.0.1
    ssl_mode: :disabled
YAML
%>

test:
  # We connect to the unsharded primary database on a different port, via a proxy,
  # so we can make the connection unavailable when testing on_replica_by_default
  # behavior.
  primary:
<%= default_config -%>
    database: ars_test

  primary_replica:
<%= default_config -%>
    database: ars_test_replica
    replica: true

  # We connect to this sharded primary database on a different port, via a proxy,
  # so we can make the connection unavailable when testing on_replica_by_default
  # behavior.
  shard_0:
<%= default_config -%>
    database: ars_test_shard0

  shard_0_replica:
<%= default_config -%>
    database: ars_test_shard0_replica
    replica: true

  # We connect to this sharded primary database on a different port, via a proxy,
  # so we can make the connection unavailable when testing on_replica_by_default
  # behavior.
  shard_1:
<%= default_config -%>
    database: ars_test_shard1

  shard_1_replica:
<%= default_config -%>
    database: ars_test_shard1_replica
    replica: true

test2:
  default:
<%= default_config -%>
    database: ars_test2

  default_replica:
<%= default_config -%>
    database: ars_test2_replica
    replica: true

test3:
  default:
<%= default_config -%>
    database: ars_test3

  default_shard_0:
<%= default_config -%>
    database: ars_test3_shard0

