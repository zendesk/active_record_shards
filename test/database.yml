<% mysql = URI(ENV['MYSQL_URL'] || 'mysql://root@127.0.0.1:3306') %>

<%
default_config = <<-YAML
    encoding: utf8
    adapter: mysql2
    username: #{mysql.user}
    host: #{mysql.host}
    port: #{mysql.port}
    password: #{mysql.password}
    ssl_mode: :disabled
YAML
%>

test:
  # We connect to the unsharded primary database on a different port, via a proxy,
  # so we can make the connection unavailable when testing on_replica_by_default
  # behavior.
  default_primary:
<%= default_config -%>
    database: ars_test
    host: 127.0.0.1
    port: 13306

  default_replica:
<%= default_config -%>
    database: ars_test_replica
    replica: true

  # We connect to this sharded primary database on a different port, via a proxy,
  # so we can make the connection unavailable when testing on_replica_by_default
  # behavior.
  shard_0_primary:
<%= default_config -%>
    database: ars_test_shard0
    host: 127.0.0.1
    port: 13307

  shard_0_replica:
<%= default_config -%>
    database: ars_test_shard0_replica
    replica: true

  # We connect to this sharded primary database on a different port, via a proxy,
  # so we can make the connection unavailable when testing on_replica_by_default
  # behavior.
  shard_1_primary:
<%= default_config -%>
    database: ars_test_shard1
    host: 127.0.0.1
    port: 13308

  shard_1_replica:
<%= default_config -%>
    database: ars_test_shard1_replica
    replica: true

# This config has a replica, but no shards
test2:
  default_primary:
<%= default_config -%>
    database: ars_test2

  default_replica:
<%= default_config -%>
    database: ars_test2_replica
    replica: true

# This config has a shard, but no replicas
test3:
  default:
<%= default_config -%>
    database: ars_test3

  default_shard_0:
<%= default_config -%>
    database: ars_test3_shard0

